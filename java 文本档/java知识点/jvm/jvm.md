类加载原理机制

1.装载：查找和导入class文件；

2.连接：

```
1.检查：检查载入的class文件数据的正确性；
2.准备：为类的静态变量分配存储空间；
3.解析：将符号引用转换成直接引用(这一步是可选的)
```

3.初始化：初始化静态变量，静态代码块。



什么是类加载器？

类加载器是一个用来加载类文件的类。Java源代码通过javac编译器编译成类文件。然后jvm来执行类文件中的字节码来执行程序。类加载器负责加载文件系统，网络或其他来源的类文件。

类加载器有哪些？

三种默认使用的类加载器：Bootstrap类加载器，Extension类加载器和Application类加载器。每种类加载器都有设定好从哪里加载类。



jvm的两种数据类型，基本类型和引用类型

基本类型：数值类型：整型，浮点型和char类型，boolean类型和returnAddress类型是一个指针，指向 jvm指令的操作码，在java中没有与之对应的类型。

引用类型：类类型，数组类型，和接口类型

它们的值都是动态创建的类实例，数组，或实现接口的类实例。

数组有component类型和element类型，component类型就是数组去掉最外层维度后剩下的类型，可能还是一个数组类型（对于多维数组）。

element类型就是数组里面存储的最小数据的类型，他必须是一个基本类型，类类型，或接口类型。

对于一位数组的话，component类型和element类型是相同的。

引用类型还有一个特殊值，就是null值，表示没有引用任何对象。



### 运行时公有数据区



#### 堆

jvm有一个堆，在所有jvm线程间共享，堆是一个运行时数据区域，所有为类实例和数组分配的内存都来自于它。

堆在jvm启动时创建，堆中对象不用现实释放，gc会帮我们释放并回收内存。

#### 方法区

jvm有一个方法区，在所有jvm线程间共享，它存储每一个类的结构。

像运行时常量池，字段和方法数据，方法和构造函数的代码，还有特殊的方法用于类和实例的初始化，以及接口的初始化。

方法区在jvm启动时创建，虽然方法区在逻辑上是堆的一部分。但简单实现时，可以选择不进行gc和压缩。

运行时常量池

#### 运行时常量池

运行时常量池就是类或接口的字节码文件里的常量池的运行时表示形式，它包含几种常量。

如在编译时就已经知道的数字字面量值，和必须在运行时解析的方法和字段的引用，运行时常量池的功能类似于传统语言的符号表，不过它包含的数据会更加宽泛。

运行时常量池分配在jvm的方法区，类或接口的运行时常量池在类或接口被jvm创建才会创建。



### 运行时私有数据区



#### pc寄存器

jvm支持一次运行多个线程，每个线程都有自己的pc寄存器，任何时候一个线程只会运行一个方法的代码。

如果方法不是native的，pc寄存器包含当前正在被执行的jvm指令地址，如果方法时native的，pc寄存器的值是未定义的。

#### jvm栈

每一个jvm都有一个自己私有的jvm栈，随着线程的创建而创建，栈中存储就是帧。

jvm栈和传统语言如c的栈相似，保存局部变量和部分计算结果，参与方法的调用和返回。jvn栈只要勇于帧的出战和入栈，除此之外没有其他操作。

帧可能是在堆上分配的，所有jvm栈使用的内存不必是连续的。

#### native方法栈

native方法不是java语言写的，为了支持他需要使用传统栈，如C语言栈，不过jvm不能加载native方法，所以也不需要提供native方法需要的栈。



### JVM

1. 基本概念
   jvm是可运行java代码的假想计算机，包括一套字节码指令集，一组寄存器，一个栈，一个垃圾回收，堆和一个存储方法域。jvm是运行在操作系统之上的，他与硬件没有直接的交互。

![8bd757638caf35ebb394135a1d6f99e](C:\Users\HITO_J~1\AppData\Local\Temp\WeChat Files\8bd757638caf35ebb394135a1d6f99e.png)

2.运行过程

我们都知道java源文件，通过编译器，能够生产相应的.class文件，也就是字节码文件，而字节码文件又通过Java虚拟机中的解释器，编译成特定机器上的机器码。

也就是说：

1. java源文件--->编译器------->字节码文件
2. 字节码文件------>JVM------->机器码

 每一种平台的解释器是不同的，但是实现的虚拟机是相同的，这也就是java为什么能够跨平台的原因，当一个程序从开始运行，这是虚拟机就开始实例化了，多个程序启动就会存在多个实例。程序退出或关闭，则虚拟机实例消亡，多个虚拟机实例之间数据不能共享。

![eb3f912bf58a2d41d06bf46057af4d6](C:\Users\HITO_J~1\AppData\Local\Temp\WeChat Files\eb3f912bf58a2d41d06bf46057af4d6.png)

这里所说的线程指程序执行过程中的一个线程实体。JVM允许一个应用并发执行多个线程。